
defaults.device: eos
provider: libvirt
plugin: [ fabric ]
bgp:
  as: 65000
  #bgp.activate.ipv4: [ ebgp ]                     # Activate IPv4 only on EBGP sessions
  activate:
     ipv6: [ ebgp ]                     # Activate IPv6 only on EBGP sessions
  sessions: 
     ipv6: [ ebgp, ibgp ]
defaults.bgp.warnings.missing_igp: False        # Skip the "you probably need an IGP" warnings

# Both IPv4 and IPv6 pools are defined.
# Underlay uses IPv4; IPv6 is used for tenant addressing and optional loopbacks and bgp sessions.
addressing:
  loopback:
    ipv4: 10.0.0.0/24
    ipv6: 2001:db8:0::/48
  p2p:
    ipv4: 10.1.0.0/16
    ipv6: 2001:db8:1::/48

groups:
  _auto_create: True
  leafs:
    members: [ leaf1, leaf2, leaf3, leaf4 ]
    module: [ bgp, vlan, vxlan, evpn, vrf, gateway ]
    config: [ eos-activate-evpn.j2 ]
    
  spines:
    members: [ spine1, spine2 ]
    module: [ bgp, evpn ]
    bgp.rr: True
    config: [ eos-activate-evpn.j2 ]

  hosts:
    members: [ srv01, srv02, srv03, srv04 ]
    device: linux

vlan.mode: irb                                   # Enable routing between VLANs

vrfs:
  tenant:
    id: 50000
    evpn:
      transit_vni: 50000

vlans:
  red:
    vrf: tenant                                  # Assign to VRF
    prefix.ipv4: 172.16.10.0/24                   # IPv4 subnet
    prefix.ipv6: 2001:db8:10::/64
    gateway: true                                # Enable gateway on this VLAN
    links: [ srv01-leaf1 ]
  blue:
    vrf: tenant                                  # Assign to VRF
    prefix.ipv4: 172.16.20.0/24                   # IPv4 subnet
    prefix.ipv6: 2001:db8:20::/64
    gateway: true                                # Enable gateway on this VLAN
    links: [ srv02-leaf2 ]
  cyan:
    vrf: tenant                                  # Assign to VRF
    prefix.ipv4: 172.16.30.0/24                   # IPv4 subnet
    prefix.ipv6: 2001:db8:30::/64
    gateway: true                                # Enable gateway on this VLAN
    links: [ srv03-leaf3, srv04-leaf4 ]

links:
- leaf1:
    bgp.local_as: 65101
  spine1:
    bgp.local_as: 65200
- leaf1:
    bgp.local_as: 65101
  spine2:
    bgp.local_as: 65200
- leaf2:
    bgp.local_as: 65102
  spine1:
    bgp.local_as: 65200
- leaf2:
    bgp.local_as: 65102
  spine2:
    bgp.local_as: 65200
- leaf3:
    bgp.local_as: 65103
  spine1:
    bgp.local_as: 65200
- leaf3:
    bgp.local_as: 65103
  spine2:
    bgp.local_as: 65200
- leaf4:
    bgp.local_as: 65104
  spine1:
    bgp.local_as: 65200
- leaf4:
    bgp.local_as: 65104
  spine2:
    bgp.local_as: 65200
